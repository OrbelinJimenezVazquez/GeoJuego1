<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Juego de Geograf√≠a ‚Äî Adivina la Silueta + Im√°genes (80‚Äì100 pa√≠ses)</title>
<style>
  :root{
    --bg:#0b1020;--card:#131a2a;--ink:#e6eefc;--muted:#9fb0d8;--accent:#5dd1ff;--good:#71e38b;--bad:#ff6b6b;--warn:#ffd166;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial,sans-serif;background:radial-gradient(1000px 800px at 80% -10%,#1a2647 0%,#0b1020 60%);color:var(--ink);}
  .wrap{max-width:1200px;margin:0 auto;padding:24px}
  header{display:flex;gap:16px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .title{display:flex;align-items:center;gap:12px}
  .title h1{font-size:clamp(20px,3vw,28px);margin:0}
  .badge{font-size:12px;padding:4px 8px;border:1px solid #2a3658;border-radius:999px;color:var(--muted)}
  .hud{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .chip{background:var(--card);border:1px solid #243253;color:var(--ink);padding:8px 10px;border-radius:10px;display:flex;gap:8px;align-items:center;min-width:fit-content}
  .chip b{color:var(--accent)}
  .toggle{display:flex;align-items:center;gap:8px;background:#10172a;border:1px solid #233154;padding:8px 10px;border-radius:10px;color:#dfe8ff}
  .toggle input{accent-color:#5dd1ff}
  .select{display:flex;align-items:center;gap:8px;background:#10172a;border:1px solid #233154;padding:8px 10px;border-radius:10px;color:#dfe8ff}
  select,button,option{font:inherit}

  .board{margin-top:18px;display:grid;grid-template-columns: 2fr 1fr;gap:16px}
  @media(max-width:900px){ .board{grid-template-columns:1fr} }

  .card{background:linear-gradient(145deg,#0f1628, #0c1424);border:1px solid #1e2a49;border-radius:16px;box-shadow:0 10px 30px rgb(0 0 0 / .25);}
  .scene{position:relative;min-height:340px;display:grid;place-items:center;padding:18px}
  .scene .svgbox{width:min(520px,90%);aspect-ratio:16/11;background:radial-gradient(600px 380px at 50% 30%, #16213e, #0d1528);border:1px solid #223055;border-radius:14px;display:grid;place-items:center;overflow:hidden}
  svg{width:92%;height:auto}
  .qbar{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px 16px;border-top:1px solid #1d2744}
  .qtext{font-size:18px;color:var(--ink)}
  .qhint{font-size:13px;color:var(--muted)}

  .choices{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;padding:14px}
  button.choice{background:#11182c;border:1px solid #263255;color:#dfe8ff;padding:12px 14px;border-radius:12px;cursor:pointer;text-align:left;font-weight:600;transition:.15s transform,.15s border-color}
  button.choice:hover{transform:translateY(-2px);border-color:#3d5aa7}
  button.choice.correct{background:rgba(113,227,139,.12);border-color:var(--good);color:#dfffef}
  button.choice.wrong{background:rgba(255,107,107,.12);border-color:var(--bad)}

  .toolbar{display:flex;gap:10px;flex-wrap:wrap;padding:0 14px 16px}
  .btn{background:#11182c;border:1px solid #263255;color:#e6eefc;padding:10px 12px;border-radius:10px;font-weight:600;cursor:pointer}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .btn.primary{background:#17244a;border-color:#3656a4}
  .btn.warn{background:#281f0a;border-color:#7a5b10;color:#ffe9b3}

  .barwrap{height:8px;background:#0e1426;border:1px solid #243153;border-radius:999px;overflow:hidden}
  .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),#95ffe5)}

  footer{margin-top:20px;display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;color:var(--muted)}

  .panel{padding:12px 14px}
  .stat{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px dashed #243153}
  .stat:last-child{border-bottom:0}
  .stat b{color:var(--ink)}
  .mini{font-size:12px;color:var(--muted)}

  .toast{position:fixed;right:16px;bottom:16px;background:#0f162a;border:1px solid #224;margin-top:8px;padding:12px 14px;border-radius:12px;color:#dff;box-shadow:0 10px 24px rgba(0,0,0,.35);opacity:0;transform:translateY(10px);transition:all .2s}
  .toast.show{opacity:1;transform:translateY(0)}

  /* Panel visual */
  .refpanel{display:grid;grid-template-rows:auto 1fr auto;gap:10px;height:100%}
  .refimgbox{position:relative;display:grid;place-items:center;background:#0e1526;border:1px solid #223055;border-radius:12px;margin:12px;overflow:hidden;min-height:220px}
  .refimgbox img{max-width:100%;max-height:100%;display:block}
  .refcaption{padding:0 12px 12px;color:var(--muted)}
  .flag{font-size:28px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M4 7.5C4 5.57 5.57 4 7.5 4h9A3.5 3.5 3.5 0 0 1 20 7.5v9A3.5 3.5 0 0 1 16.5 20h-9A3.5 3.5 0 0 1 4 16.5v-9Z" stroke="#5dd1ff" stroke-width="1.4"/><path d="M11.5 6.5c.4 1.5 1.6 3.6 4 4 2.3.3 1.8 3-1 3.5-3 .5-2.3 3.3-1.5 4.5" stroke="#95ffe5" stroke-width="1.4"/></svg>
        <h1>Geograf√≠a ‚Äî Adivina la Silueta</h1>
        <span class="badge">80‚Äì100 pa√≠ses + im√°genes de referencia</span>
      </div>
      <div class="hud">
        <div class="chip">Racha üî• <b id="streak">0</b></div>
        <div class="chip">Puntos ‚≠ê <b id="score">0</b></div>
        <div class="chip">Mejor puntaje üèÜ <b id="best">0</b></div>
        <label class="toggle"><input type="checkbox" id="toggleImages" checked> Mostrar im√°genes</label>
        <label class="select">Rondas
          <select id="roundsSelect">
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="40">40</option>
            <option value="all">Banco completo</option>
          </select>
        </label>
        <button class="btn primary" id="btnStart">Empezar</button>
      </div>
    </header>

    <div class="board">
      <div class="card" style="grid-column:1/2">
        <div class="scene">
          <div class="svgbox">
            <svg id="silhouette" viewBox="0 0 1000 700" aria-label="Figura a adivinar" role="img"></svg>
          </div>
        </div>
        <div class="qbar">
          <div>
            <div class="qtext" id="questionText">¬øQu√© pa√≠s es?</div>
            <div class="qhint" id="hintText">Pista: ‚Äî</div>
          </div>
          <div style="min-width:220px;display:flex;align-items:center;gap:10px">
            <div class="barwrap" style="flex:1 1 auto"><div id="progress" class="bar"></div></div>
            <span id="roundBadge" class="badge">0/0</span>
          </div>
        </div>
        <div class="choices" id="choices"></div>
        <div class="toolbar">
          <button class="btn" id="btnHint">Pista</button>
          <button class="btn warn" id="btnSkip">Saltar</button>
          <button class="btn" id="btnReset">Reiniciar</button>
          <button class="btn primary" id="btnStudy">Modo estudio</button>
        </div>
      </div>

      <div class="card refpanel">
        <div class="panel">
          <h3 style="margin:6px 0 8px">Imagen de referencia</h3>
          <p class="mini">Ver√°s la bandera (flagcdn.com) o una foto. Puedes desactivar el panel.</p>
        </div>
        <div class="refimgbox">
          <img id="refImg" alt="Referencia"/>
        </div>
        <div class="refcaption mini" id="refCaption">‚Äî</div>
      </div>

      <div class="card panel" style="grid-column:1/-1">
        <div style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:16px">
          <div>
            <h3 style="margin:6px 0 8px">Estad√≠sticas</h3>
            <div class="stat"><span>Correctas</span><b id="ok">0</b></div>
            <div class="stat"><span>Incorrectas</span><b id="ko">0</b></div>
            <div class="stat"><span>Racha m√°x.</span><b id="maxStreak">0</b></div>
            <div class="stat"><span>Exp total</span><b id="xp">0</b></div>
            <p class="mini">La EXP sube m√°s con respuestas seguras y rachas altas.</p>
          </div>
          <div>
            <h3 style="margin:6px 0 8px">Instrucciones</h3>
            <ul style="margin:0 0 8px 18px;line-height:1.6">
              <li>Observa la silueta (pa√≠s) o el √≠cono (relieve).</li>
              <li>Elige una de las 4 opciones. <em>Puedes pedir una pista</em>.</li>
              <li>Gana <b>10 pts</b> por acierto + <b>bono por racha</b>. Pierdes <b>5 pts</b> si fallas.</li>
              <li>Selecciona cu√°ntas rondas quieres jugar.</li>
            </ul>
          </div>
          <div>
            <h3 style="margin:6px 0 8px">Modo estudio</h3>
            <ul style="margin:0 0 8px 18px;line-height:1.6">
              <li>Muestra el nombre/emoji bandera sobre la silueta.</li>
              <li>Usa el panel de imagen para contextualizar.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <div>¬© 2025 ‚Ä¢ Hecho para practicar Geograf√≠a üåé</div>
      <div class="mini">Racha/record se guardan en tu navegador.</div>
    </footer>
  </div>

  <div id="toast" class="toast" aria-live="polite"></div>

<script>
// ======================
// Auxiliares: banderas e im√°genes
// ======================
function flagEmojiFromCode(code){
  const a = code.toUpperCase();
  return String.fromCodePoint(...[...a].map(c=>0x1F1E6 + (c.charCodeAt(0)-65)));
}
function flagImgUrl(code){ return `https://flagcdn.com/w320/${code.toLowerCase()}.png`; }

// ======================
// Generador de siluetas (pseudo) para muchos pa√≠ses
// Dibuja una forma determin√≠stica basada en el nombre para evitar definir cientos de paths.
// Para pa√≠ses clave dejamos siluetas manuales simples.
// ======================
function seededRand(seed){
  let t = seed>>>0;
  return ()=> (t = (t*1664525 + 1013904223)>>>0) / 2**32;
}
function nameHash(s){ let h=2166136261; for(const ch of s) h = Math.imul(h ^ ch.charCodeAt(0), 16777619); return h>>>0; }
function generatedShape(g, name){
  const rnd = seededRand(nameHash(name));
  const cx = 520, cy = 320; const rBase = 160;
  const n = 10 + Math.floor(rnd()*6); // 10-15 v√©rtices
  let d = '';
  for(let i=0;i<n;i++){
    const ang = (i/n)*Math.PI*2 + rnd()*0.15;
    const r = rBase * (0.65 + rnd()*0.5);
    const x = cx + Math.cos(ang)*r;
    const y = cy + Math.sin(ang)*r* (0.70 + rnd()*0.25);
    d += (i? ' L ':'M ')+ x.toFixed(1) + ' ' + y.toFixed(1);
  }
  d += ' Z';
  const p = document.createElementNS('http://www.w3.org/2000/svg','path');
  p.setAttribute('d', d);
  p.setAttribute('fill','#2b69ff22');
  p.setAttribute('stroke','#8fdcff');
  p.setAttribute('stroke-width','4');
  p.setAttribute('vector-effect','non-scaling-stroke');
  p.setAttribute('stroke-linejoin','round');
  g.appendChild(p);
}

// ======================
// Siluetas manuales para algunas referencias
// ======================
function path(g,d){
  const p=document.createElementNS('http://www.w3.org/2000/svg','path');
  p.setAttribute('d',d);
  p.setAttribute('fill','#2b69ff22');
  p.setAttribute('stroke','#8fdcff');
  p.setAttribute('stroke-width','4');
  p.setAttribute('vector-effect','non-scaling-stroke');
  p.setAttribute('stroke-linejoin','round');
  g.appendChild(p);
}
function dot(g,cx,cy,r=5){
  const c=document.createElementNS('http://www.w3.org/2000/svg','circle');
  c.setAttribute('cx',cx);c.setAttribute('cy',cy);c.setAttribute('r',r);
  c.setAttribute('fill','#2b69ff22');
  c.setAttribute('stroke','#8fdcff');
  c.setAttribute('stroke-width','3');
  c.setAttribute('vector-effect','non-scaling-stroke');
  g.appendChild(c);
}
function mx(g){ path(g,"M 120 330 L 220 260 L 300 250 L 350 210 L 420 220 L 470 260 L 520 260 L 555 280 L 590 330 L 560 360 L 520 355 L 500 370 L 470 380 L 410 360 L 360 350 L 320 340 L 300 360 L 260 370 L 200 360 L 160 345 Z"); dot(g, 540, 290, 8); }
function br(g){ path(g,"M 640 220 L 700 210 L 740 240 L 760 300 L 720 340 L 690 360 L 650 360 L 610 330 L 590 290 L 610 250 Z"); }
function ar(g){ path(g,"M 760 360 L 750 420 L 740 480 L 730 520 L 720 560 L 710 620 L 690 640 L 680 610 L 690 560 L 700 520 L 710 470 L 720 420 L 730 380 Z"); }
function us(g){ path(g,"M 180 220 L 260 200 L 360 190 L 460 200 L 560 210 L 600 230 L 560 260 L 520 260 L 470 260 L 420 240 L 360 240 L 300 240 L 240 250 L 200 240 Z"); }
function ca(g){ path(g,"M 160 160 L 260 140 L 360 140 L 460 150 L 540 160 L 560 140 L 600 150 L 620 170 L 560 180 L 520 170 L 460 170 L 400 170 L 340 160 L 260 160 L 200 170 Z"); }
function it(g){ path(g,"M 660 230 L 640 250 L 620 260 L 640 280 L 660 300 L 680 310 L 700 300 L 710 290 L 700 280 L 680 270 L 690 260 L 700 250 L 690 240 Z"); dot(g, 715, 305, 6); }
function jp(g){ dot(g, 860, 260, 6); dot(g, 850, 280, 7); dot(g, 845, 300, 6); dot(g, 855, 320, 5); }
function au(g){ path(g,"M 860 420 L 900 430 L 930 460 L 910 500 L 870 520 L 830 500 L 820 460 Z"); dot(g, 940, 500, 4); }

// ======================
// Banco de pa√≠ses (90 aprox.) usando c√≥digo ISO + banderas (flagcdn)
// svg: manual para algunos, generada para la mayor√≠a
// ======================
const COUNTRIES = [
  // Am√©rica del Norte & Centro
  C('mx','M√©xico','Am√©rica',mx), C('us','Estados Unidos','Am√©rica',us), C('ca','Canad√°','Am√©rica',ca),
  C('gt','Guatemala','Am√©rica'), C('bz','Belice','Am√©rica'), C('sv','El Salvador','Am√©rica'), C('hn','Honduras','Am√©rica'), C('ni','Nicaragua','Am√©rica'), C('cr','Costa Rica','Am√©rica'), C('pa','Panam√°','Am√©rica'),
  C('cu','Cuba','Am√©rica'), C('do','Rep√∫blica Dominicana','Am√©rica'), C('ht','Hait√≠','Am√©rica'), C('jm','Jamaica','Am√©rica'), C('bs','Bahamas','Am√©rica'),
  // Am√©rica del Sur
  C('br','Brasil','Am√©rica',br), C('ar','Argentina','Am√©rica',ar), C('cl','Chile','Am√©rica'), C('uy','Uruguay','Am√©rica'), C('py','Paraguay','Am√©rica'), C('bo','Bolivia','Am√©rica'), C('pe','Per√∫','Am√©rica'), C('ec','Ecuador','Am√©rica'), C('co','Colombia','Am√©rica'), C('ve','Venezuela','Am√©rica'), C('gy','Guyana','Am√©rica'), C('sr','Surinam','Am√©rica'),
  // Europa Occidental y Norte
  C('es','Espa√±a','Europa'), C('pt','Portugal','Europa'), C('fr','Francia','Europa'), C('gb','Reino Unido','Europa'), C('ie','Irlanda','Europa'), C('de','Alemania','Europa'), C('it','Italia','Europa',it), C('ch','Suiza','Europa'), C('at','Austria','Europa'), C('nl','Pa√≠ses Bajos','Europa'), C('be','B√©lgica','Europa'), C('lu','Luxemburgo','Europa'),
  C('dk','Dinamarca','Europa'), C('no','Noruega','Europa'), C('se','Suecia','Europa'), C('fi','Finlandia','Europa'), C('is','Islandia','Europa'),
  // Europa Central / Este / Balcanes
  C('pl','Polonia','Europa'), C('cz','Chequia','Europa'), C('sk','Eslovaquia','Europa'), C('hu','Hungr√≠a','Europa'), C('ro','Ruman√≠a','Europa'), C('bg','Bulgaria','Europa'), C('gr','Grecia','Europa'), C('al','Albania','Europa'), C('mk','Macedonia del Norte','Europa'), C('rs','Serbia','Europa'), C('ba','Bosnia y Herzegovina','Europa'), C('hr','Croacia','Europa'), C('si','Eslovenia','Europa'), C('me','Montenegro','Europa'), C('xk','Kosovo','Europa'),
  C('ee','Estonia','Europa'), C('lv','Letonia','Europa'), C('lt','Lituania','Europa'),
  C('ua','Ucrania','Europa'), C('by','Bielorrusia','Europa'), C('md','Moldavia','Europa'), C('ru','Rusia','Europa/Asia'),
  // Medio Oriente & C√°ucaso
  C('tr','Turqu√≠a','Europa/Asia'), C('cy','Chipre','Europa/Asia'), C('ge','Georgia','Asia'), C('am','Armenia','Asia'), C('az','Azerbaiy√°n','Asia'),
  C('sa','Arabia Saudita','Asia'), C('ae','Emiratos √Årabes Unidos','Asia'), C('qa','Catar','Asia'), C('bh','Bar√©in','Asia'), C('kw','Kuwait','Asia'), C('om','Om√°n','Asia'), C('ye','Yemen','Asia'),
  C('ir','Ir√°n','Asia'), C('iq','Irak','Asia'), C('sy','Siria','Asia'), C('lb','L√≠bano','Asia'), C('il','Israel','Asia'), C('jo','Jordania','Asia'),
  // Asia meridional
  C('af','Afganist√°n','Asia'), C('pk','Pakist√°n','Asia'), C('in','India','Asia'), C('np','Nepal','Asia'), C('bt','But√°n','Asia'), C('bd','Banglad√©s','Asia'), C('lk','Sri Lanka','Asia'), C('mv','Maldivas','Asia'),
  // Asia oriental y sudeste
  C('cn','China','Asia'), C('mn','Mongolia','Asia'), C('kp','Corea del Norte','Asia'), C('kr','Corea del Sur','Asia'), C('jp','Jap√≥n','Asia',jp), C('tw','Taiw√°n','Asia'),
  C('mm','Myanmar','Asia'), C('th','Tailandia','Asia'), C('la','Laos','Asia'), C('kh','Camboya','Asia'), C('vn','Vietnam','Asia'), C('my','Malasia','Asia'), C('sg','Singapur','Asia'), C('id','Indonesia','Asia'), C('ph','Filipinas','Asia'), C('bn','Brun√©i','Asia'), C('tl','Timor Oriental','Asia'),
  // Ocean√≠a
  C('au','Australia','Ocean√≠a',au), C('nz','Nueva Zelanda','Ocean√≠a'), C('pg','Pap√∫a Nueva Guinea','Ocean√≠a'), C('fj','Fiyi','Ocean√≠a'), C('ws','Samoa','Ocean√≠a'), C('to','Tonga','Ocean√≠a'), C('vu','Vanuatu','Ocean√≠a'), C('sb','Islas Salom√≥n','Ocean√≠a'), C('fm','Micronesia','Ocean√≠a'), C('ki','Kiribati','Ocean√≠a'), C('pw','Palaos','Ocean√≠a'), C('nr','Nauru','Ocean√≠a'), C('tv','Tuvalu','Ocean√≠a'),
  // √Åfrica Norte & Oeste
  C('ma','Marruecos','√Åfrica'), C('dz','Argelia','√Åfrica'), C('tn','T√∫nez','√Åfrica'), C('ly','Libia','√Åfrica'), C('eg','Egipto','√Åfrica'), C('mr','Mauritania','√Åfrica'), C('eh','Sahara Occidental','√Åfrica'),
  C('sn','Senegal','√Åfrica'), C('gm','Gambia','√Åfrica'), C('gw','Guinea-Bis√°u','√Åfrica'), C('gn','Guinea','√Åfrica'), C('sl','Sierra Leona','√Åfrica'), C('lr','Liberia','√Åfrica'), C('ci','Costa de Marfil','√Åfrica'), C('gh','Ghana','√Åfrica'), C('tg','Togo','√Åfrica'), C('bj','Ben√≠n','√Åfrica'), C('ng','Nigeria','√Åfrica'), C('ne','N√≠ger','√Åfrica'), C('bf','Burkina Faso','√Åfrica'), C('ml','Mal√≠','√Åfrica'),
  // √Åfrica Central & Este & Austral
  C('td','Chad','√Åfrica'), C('cm','Camer√∫n','√Åfrica'), C('cf','Rep√∫blica Centroafricana','√Åfrica'), C('gq','Guinea Ecuatorial','√Åfrica'), C('ga','Gab√≥n','√Åfrica'), C('cg','Rep√∫blica del Congo','√Åfrica'), C('cd','R. D. del Congo','√Åfrica'), C('ao','Angola','√Åfrica'), C('na','Namibia','√Åfrica'), C('bw','Botsuana','√Åfrica'), C('zw','Zimbabue','√Åfrica'), C('zm','Zambia','√Åfrica'), C('mw','Malaui','√Åfrica'), C('mz','Mozambique','√Åfrica'), C('tz','Tanzania','√Åfrica'), C('ke','Kenia','√Åfrica'), C('ug','Uganda','√Åfrica'), C('rw','Ruanda','√Åfrica'), C('bi','Burundi','√Åfrica'), C('so','Somalia','√Åfrica'), C('et','Etiop√≠a','√Åfrica'), C('er','Eritrea','√Åfrica'), C('dj','Yibuti','√Åfrica'), C('ss','Sud√°n del Sur','√Åfrica'), C('sd','Sud√°n','√Åfrica'), C('za','Sud√°frica','√Åfrica'), C('ls','Lesoto','√Åfrica'), C('sz','Esuatini','√Åfrica'), C('mg','Madagascar','√Åfrica'), C('mu','Mauricio','√Åfrica'), C('sc','Seychelles','√Åfrica'), C('km','Comoras','√Åfrica')
];

function C(code,label,continent,customSvg){
  return {
    id:code,label,continent,code,
    flag: flagEmojiFromCode(code),
    img: flagImgUrl(code),
    svg: customSvg ? (g)=>customSvg(g) : (g)=>generatedShape(g,label)
  };
}

// Relieves (se mantienen como antes)
const RELIEFS = [
  { id:'mountain', type:'relief', label:'Cordillera (monta√±as)', note:'Elevaciones alineadas con picos.', img:'https://upload.wikimedia.org/wikipedia/commons/thumb/8/8b/Andes_La_Paz_Bolivia.jpg/320px-Andes_La_Paz_Bolivia.jpg', svg:(g)=>{ mountainRange(g, 5, 520, 360); } },
  { id:'volcano', type:'relief', label:'Volc√°n', note:'Cono con cr√°ter en la cima.', img:'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5a/Popocatepetl_from_Paso_de_Cortes.jpg/320px-Popocatepetl_from_Paso_de_Cortes.jpg', svg:(g)=>{ const d=`M 400 520 L 520 330 L 640 520 Z`; path(g,d); for(let i=0;i<4;i++) dot(g,520+(Math.random()*20-10), 300-i*22, 8-i);} },
  { id:'river', type:'relief', label:'R√≠o me√°ndrico', note:'Curso de agua sinuoso.', img:'https://upload.wikimedia.org/wikipedia/commons/thumb/4/4e/Meanders.jpg/320px-Meanders.jpg', svg:(g)=>{ const midX=580,midY=360; const d=`M 180 180 C ${midX-120} ${midY-150}, ${midX+120} ${midY+150}, 820 480`; const p=document.createElementNS('http://www.w3.org/2000/svg','path'); p.setAttribute('d',d); p.setAttribute('stroke','#53e0ff'); p.setAttribute('stroke-width','14'); p.setAttribute('fill','none'); g.appendChild(p);} },
  { id:'plateau', type:'relief', label:'Altiplano / Meseta', note:'Superficie alta y plana.', img:'https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Altiplano_Boliviano.jpg/320px-Altiplano_Boliviano.jpg', svg:(g)=>{ const d=`M 320 420 L 420 320 L 620 320 L 720 420 Z`; path(g,d);} },
  { id:'dune', type:'relief', label:'Dunas (desierto)', note:'Acumulaciones de arena e√≥lica.', img:'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Sossusvlei_Dunes.jpg/320px-Sossusvlei_Dunes.jpg', svg:(g)=>{ for(let i=0;i<4;i++){ const x=220+i*130,y=440+(i%2?20:0),w=90,h=30; const d=`M ${x} ${y} Q ${x+w/2} ${y-h} ${x+w} ${y}`; const p=document.createElementNS('http://www.w3.org/2000/svg','path'); p.setAttribute('d',d); p.setAttribute('fill','none'); p.setAttribute('stroke','#8fdcff'); p.setAttribute('stroke-width','8'); g.appendChild(p);} } },
  { id:'valley', type:'relief', label:'Valle en U', note:'Valle glaciar de fondo plano.', img:'https://upload.wikimedia.org/wikipedia/commons/thumb/2/26/Glacial_valley%2C_Switzerland.jpg/320px-Glacial_valley%2C_Switzerland.jpg', svg:(g)=>{ const d=`M 340 440 L 460 300 L 540 360 L 620 300 L 740 440`; const p=document.createElementNS('http://www.w3.org/2000/svg','path'); p.setAttribute('d',d); p.setAttribute('fill','none'); p.setAttribute('stroke','#8fdcff'); p.setAttribute('stroke-width','8'); g.appendChild(p);} }
];

// ======================
// Estado y elementos
// ======================
const ITEMS = [...COUNTRIES, ...RELIEFS];
let TOTAL_ROUNDS = 10; // por defecto

let state = {
  round: 0, score: 0, exp: 0,
  correct: 0, wrong: 0,
  streak: 0, maxStreak: 0,
  current:null, options:[], study:false
};

const el = (sel)=>document.querySelector(sel);
const $sil = el('#silhouette');
const $choices = el('#choices');
const $qtext = el('#questionText');
const $hint = el('#hintText');
const $streak = el('#streak');
const $score = el('#score');
const $best = el('#best');
const $ok = el('#ok');
const $ko = el('#ko');
const $xp = el('#xp');
const $maxS = el('#maxStreak');
const $progress = el('#progress');
const $roundBadge = el('#roundBadge');
const $toast = el('#toast');
const $refImg = el('#refImg');
const $refCaption = el('#refCaption');
const $toggleImages = el('#toggleImages');
const $roundsSelect = el('#roundsSelect');
const $btnStart = el('#btnStart');
const $btnHint = el('#btnHint');
const $btnSkip = el('#btnSkip');
const $btnReset = el('#btnReset');
const $btnStudy = el('#btnStudy');

function beep(good=true){
  const a = new (window.AudioContext||window.webkitAudioContext)();
  const o = a.createOscillator();
  const g = a.createGain();
  o.type = good? 'triangle':'sawtooth';
  o.frequency.value = good? 720:220;
  o.connect(g); g.connect(a.destination);
  g.gain.setValueAtTime(0.001,a.currentTime);
  g.gain.exponentialRampToValueAtTime(0.2, a.currentTime+0.02);
  o.start();
  setTimeout(()=>{ g.gain.exponentialRampToValueAtTime(0.0001, a.currentTime+0.12); o.stop(a.currentTime+0.14); }, 120);
}

function toast(msg){ $toast.textContent = msg; $toast.classList.add('show'); setTimeout(()=> $toast.classList.remove('show'), 1400); }
function rand(n){ return Math.floor(Math.random()*n); }
function sample(arr,k){ const a=[...arr]; const out=[]; while(out.length<k && a.length){ out.push(a.splice(rand(a.length),1)[0]); } return out; }
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }

function setRefImage(item){
  const show = $toggleImages.checked;
  if(!show){ $refImg.src=''; $refImg.alt=''; $refCaption.textContent='Im√°genes desactivadas'; return; }
  let caption = '';
  if(item.type==='relief'){
    caption = `${item.label} ‚Äî imagen de referencia.`;
  }else{
    caption = `${item.flag||''} ${item.label} ‚Äî bandera.`;
  }
  if(item.img){ $refImg.src = item.img; $refImg.alt = caption; $refCaption.textContent = caption; }
  else { $refImg.removeAttribute('src'); $refCaption.textContent = '‚Äî'; }
}

function startGame(){
  const sel = $roundsSelect.value;
  TOTAL_ROUNDS = sel==='all' ? ITEMS.length : parseInt(sel,10);
  reset(false);
  toast(`üéÆ ¬°Comienza! Rondas: ${sel==='all'? 'Banco completo': TOTAL_ROUNDS}`);
}

function newRound(){
  state.round++;
  $progress.style.width = `${(state.round-1)/Math.max(1,TOTAL_ROUNDS)*100}%`;
  $roundBadge.textContent = `${Math.min(state.round,TOTAL_ROUNDS)}/${TOTAL_ROUNDS}`;
  const pool = Math.random()<0.75? COUNTRIES: ITEMS; // prioriza pa√≠ses
  const item = pool[rand(pool.length)];
  state.current = item;
  renderFigure(item);
  setRefImage(item);
  if(item.type==='relief'){
    $qtext.textContent = '¬øQu√© relieve se muestra?';
    $hint.textContent = 'Pista: relieve terrestre';
    const opts = new Set([item.label]);
    const distract = sample(RELIEFS.filter(r=>r.id!==item.id), 8);
    for(const d of distract){ if(opts.size>=4) break; opts.add(d.label); }
    state.options = shuffle([...opts]);
  }else{
    $qtext.textContent = '¬øQu√© pa√≠s es?';
    $hint.textContent = 'Pista: continente ‚Äî '+ item.continent;
    const opts = new Set([item.label]);
    const distract = sample(COUNTRIES.filter(c=>c.id!==item.id), 12);
    for(const d of distract){ if(opts.size>=4) break; opts.add(d.label); }
    state.options = shuffle([...opts]);
  }
  renderChoices();
}

function renderFigure(item){
  $sil.innerHTML='';
  const g=document.createElementNS('http://www.w3.org/2000/svg','g');
  $sil.appendChild(g);
  item.svg(g);
  if(state.study){
    const t=document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('x','20'); t.setAttribute('y','40'); t.setAttribute('fill','#bfe2ff'); t.setAttribute('font-size','24');
    t.textContent = (item.type==='relief'? 'Relieve: ':'Pa√≠s: ')+ item.label + (item.flag? ' '+item.flag:'');
    $sil.appendChild(t);
  }
}

function renderChoices(){
  $choices.innerHTML='';
  state.options.forEach(opt=>{
    const btn=document.createElement('button');
    btn.className='choice';
    btn.textContent = opt;
    btn.onclick=()=>check(opt,btn);
    $choices.appendChild(btn);
  });
}

function endIfNeeded(){
  if(state.round>=TOTAL_ROUNDS){
    $progress.style.width = '100%';
    const best = Number(localStorage.getItem('geo_best')||0);
    if(state.score>best){ localStorage.setItem('geo_best', String(state.score)); toast('üéâ ¬°Nuevo r√©cord!'); }
    setTimeout(()=>{
      toast(`Ronda completa: ${state.correct}‚úî / ${state.wrong}‚úñ ‚Äî Pts: ${state.score}`);
      // no reiniciar autom√°tico; espera al bot√≥n Empezar
    }, 400);
    return true;
  }
  return false;
}

function check(opt,btn){
  const correctLabel = state.current.label;
  const buttons=[...document.querySelectorAll('button.choice')];
  buttons.forEach(b=>b.disabled=true);
  if(opt===correctLabel){
    btn.classList.add('correct');
    state.correct++; state.streak++; state.maxStreak = Math.max(state.maxStreak, state.streak);
    const bonus = Math.min(15, 5 + Math.floor(state.streak/2));
    state.score += 10 + bonus; state.exp += 12 + bonus;
    beep(true); toast(`‚úî ¬°Correcto! +${10+bonus} (Bono racha ${bonus})`);
  }else{
    btn.classList.add('wrong');
    state.wrong++; state.streak=0; state.score = Math.max(0, state.score-5);
    beep(false); toast('‚úñ Incorrecto ‚Äî ‚àí5 pts');
    buttons.find(b=>b.textContent===correctLabel)?.classList.add('correct');
  }
  syncHUD();
  setTimeout(()=>{ if(!endIfNeeded()) newRound(); }, 600);
}

function syncHUD(){
  $streak.textContent=state.streak; $score.textContent=state.score; $ok.textContent=state.correct; $ko.textContent=state.wrong; $xp.textContent=state.exp; $maxS.textContent=state.maxStreak;
  $best.textContent = localStorage.getItem('geo_best')||'0';
}

function reset(showToast=true){
  state.round=0; state.score=0; state.exp=0; state.correct=0; state.wrong=0; state.streak=0; state.maxStreak=0; state.current=null; state.options=[];
  $progress.style.width='0%'; $roundBadge.textContent = `0/${TOTAL_ROUNDS}`;
  $sil.innerHTML=''; $choices.innerHTML='';
  if(showToast) toast('üîÑ Juego reiniciado');
}

// Controles
$btnHint.onclick=()=>{ toast($hint.textContent.replace('Pista: ','üí° ')); };
$btnSkip.onclick=()=>{ state.wrong++; state.streak=0; syncHUD(); toast('‚è≠ Pregunta saltada'); if(!endIfNeeded()) newRound(); };
$btnReset.onclick=()=> reset(true);
$btnStudy.onclick=()=>{ state.study=!state.study; $btnStudy.classList.toggle('primary', state.study); $btnStudy.textContent = state.study? 'Salir estudio':'Modo estudio'; renderFigure(state.current||{svg:()=>{}}); };
$toggleImages.addEventListener('change',()=> setRefImage(state.current||{}));
$btnStart.onclick=()=> startGame();

// Init
(function init(){
  const best = Number(localStorage.getItem('geo_best')||0);
  localStorage.setItem('geo_best', String(best));
  syncHUD();
})();

</script>
</body>
</html>
